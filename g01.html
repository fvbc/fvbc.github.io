<!DOCTYPE html>
<html>
  <head>
    <title>ブロック崩しゲーム</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #f0f0f0;
      }
      canvas {
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas"></canvas>
    <script>
      const canvas = document.getElementById("gameCanvas");
      const context = canvas.getContext("2d");

      // キャンバスのサイズを設定
      const width = window.innerWidth;
      const height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;

      // パドルの設定
      const paddleWidth = 100;
      const paddleHeight = 10;
      let paddleX = (canvas.width - paddleWidth) / 2;
      const paddleSpeed = 8;

      // ボールの設定
      const ballRadius = 10;
      let ballX = canvas.width / 2;
      let ballY = canvas.height - 30;
      let ballDX = 2;
      let ballDY = -2;

      // ブロックの設定
      const brickRowCount = 3;
      const brickColumnCount = 5;
      const brickWidth = 80;
      const brickHeight = 20;
      const brickPadding = 10;
      const brickOffsetTop = 30;
      const brickOffsetLeft = 30;
      const bricks = [];

      for (let c = 0; c < brickColumnCount; c++) {
        bricks[c] = [];
        for (let r = 0; r < brickRowCount; r++) {
          bricks[c][r] = { x: 0, y: 0, status: 1 };
        }
      }

      // スコアの初期化
      let score = 0;

      // ユーザーのパドル操作
      let rightPressed = false;
      let leftPressed = false;

      document.addEventListener("keydown", (e) => {
        if (e.key == "Right" || e.key == "ArrowRight") {
          rightPressed = true;
        } else if (e.key == "Left" || e.key == "ArrowLeft") {
          leftPressed = true;
        }
      });

      document.addEventListener("keyup", (e) => {
        if (e.key == "Right" || e.key == "ArrowRight") {
          rightPressed = false;
        } else if (e.key == "Left" || e.key == "ArrowLeft") {
          leftPressed = false;
        }
      });

      // ブロックとの当たり判定
      function collisionDetection() {
        for (let c = 0; c < brickColumnCount; c++) {
          for (let r = 0; r < brickRowCount; r++) {
            const brick = bricks[c][r];
            if (brick.status == 1) {
              if (
                ballX > brick.x &&
                ballX < brick.x + brickWidth &&
                ballY > brick.y &&
                ballY < brick.y + brickHeight
              ) {
                ballDY = -ballDY;
                brick.status = 0;
                score++;
                if (score == brickRowCount * brickColumnCount) {
                  alert("おめでとう！ブロックを全て破壊しました！");
                  document.location.reload();
                }
              }
            }
          }
        }
      }

      // パドルの描画
      function drawPaddle() {
        context.beginPath();
        context.rect(paddleX, canvas.height - paddleHeight, paddleWidth, paddleHeight);
        context.fillStyle = "#0095DD";
        context.fill();
        context.closePath();
      }

      // ボールの描画
      function drawBall() {
        context.beginPath();
        context.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
        context.fillStyle = "#0095DD";
        context.fill();
        context.closePath();
      }

      // ブロックの描画
      function drawBricks() {
        for (let c = 0; c < brickColumnCount; c++) {
          for (let r = 0; r < brickRowCount; r++) {
            if (bricks[c][r].status == 1) {
              const brickX = c * (brickWidth + brickPadding) + brickOffsetLeft;
              const brickY = r * (brickHeight + brickPadding) + brickOffsetTop;
              bricks[c][r].x = brickX;
              bricks[c][r].y = brickY;
              context.beginPath();
              context.rect(brickX, brickY, brickWidth, brickHeight);
              context.fillStyle = "#0095DD";
              context.fill();
              context.closePath();
            }
          }
        }
      }

      // スコア表示
      function drawScore() {
        context.font = "16px Arial";
        context.fillStyle = "#0095DD";
        context.fillText("Score: " + score, 8, 20);
      }

      // ゲームオーバー表示
      function drawGameOver() {
        context.font = "36px Arial";
        context.fillStyle = "#0095DD";
        context.fillText("Game Over", canvas.width / 2 - 100, canvas.height / 2);
      }

      // ゲームのメインループ
      function draw() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        drawBricks();
        drawBall();
        drawPaddle();
        drawScore();
        collisionDetection();

        if (rightPressed && paddleX < canvas.width - paddleWidth) {
          paddleX += paddleSpeed;
        } else if (leftPressed && paddleX > 0) {
          paddleX -= paddleSpeed;
        }

        ballX += ballDX;
        ballY += ballDY;

        // ボールの壁とパドルの当たり判定
        if (ballX + ballDX > canvas.width - ballRadius || ballX + ballDX < ballRadius) {
          ballDX = -ballDX;
        }
        if (ballY + ballDY < ballRadius) {
          ballDY = -ballDY;
        } else if (
          ballY + ballDY > canvas.height - ballRadius - paddleHeight &&
          ballX > paddleX &&
          ballX < paddleX + paddleWidth
        ) {
          ballDY = -ballDY;
        } else if (ballY + ballDY > canvas.height - ballRadius) {
          // ゲームオーバー
          drawGameOver();
          return;
        }

        requestAnimationFrame(draw);
      }

      draw();
    </script>
  </body>
</html>
